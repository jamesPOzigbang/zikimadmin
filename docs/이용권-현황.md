# 이용권 현황 페이지 PRD

## 📄 페이지 정보

- **파일명**: `payment-history.html`
- **페이지명**: 이용권 현황
- **URL 경로**: `/payment-history.html`

---

## 1. 개요

### 1.1 페이지 목적

이용권 현황 페이지는 사용자의 유료/무료 리포트 이용권 구매 및 사용 내역을 조회하고 관리하는 페이지입니다. 관리자는 전체적인 이용권 판매 및 환불 현황을 파악하고, 개별 결제 건에 대한 환불 처리를 수행할 수 있습니다.

### 1.2 주요 기능

- **이용권 현황 대시보드**: 기간별 유료/무료 구매, 환불, 실패 건수 요약 제공
- **결제 내역 조회 및 검색**: 날짜, 이메일, 전화번호, 상품 유형, 결제 상태별 필터링
- **개인정보 보호**: 고객 이메일 및 전화번호 마스킹 처리 (검색은 원본 데이터로 가능)
- **환불 관리**: 환불 요청 내역 확인 및 즉시 환불 처리 (부분 환불 수량 지정 가능)

---

## 2. 정책

### 2.1 접근 권한

- **관리자 권한**: 이용권 관리 권한이 있는 관리자만 접근 가능

### 2.2 개인정보 마스킹 정책

- **이메일**: 앞 2자리 노출 후 나머지 마스킹 (예: `us******@example.com`)
- **전화번호**: 가운데 4자리 마스킹 (예: `010-****-5678`)
- **검색**: 마스킹된 상태에서도 원본 이메일 및 전화번호로 검색 가능해야 함

### 2.3 현황 카드 집계 정책

상단 5개 현황 카드(유료 구매수, 무료 발급수, 환불 신청수, 환불 완료수, 실패수)는 **'진행상태' 필터의 영향을 받지 않습니다.**
- 즉, 테이블 리스트에서 '결제 완료' 건만 보더라도, 상단 카드는 설정된 기간/검색어 조건 내의 **모든 상태**에 대한 통계를 보여주어 전체적인 맥락을 유지합니다.

---

## 3. 기능 상세

### 3.1 현황 대시보드 (Status Cards)

테이블 상단에 5개의 카드로 핵심 지표를 표시합니다.
1. **기간중 유료 구매수**: 선택된 기간 내 발생한 유료 결제(`amount > 0`) 중 완료된 건수
2. **무료 발급수**: 선택된 기간 내 발생한 무료 이용권(`amount == 0`) 건수
3. **환불 신청수**: 환불 요청 상태인 건수
4. **환불 완료수**: 환불 처리가 완료된 건수
5. **실패수**: 결제 실패 건수

### 3.2 검색 및 필터

- **날짜 범위**: 결제일시 기준 조회 기간 설정 (기본: 전체/오늘/1주일/1개월 등)
- **검색어**:
  - **이메일**: 고객 이메일 (부분 일치)
  - **휴대폰번호**: 고객 전화번호 (부분 일치)
- **항목 구분**: 전체 / 유료 리포트 / 무료 리포트 / 5회 이용권 등 상품 타입 필터
- **진행상태**: 전체 / 결제 완료 / 결제 실패 / 환불 요청 / 환불 완료

### 3.3 결제 내역 리스트 (Table)

| 컬럼명 | 설명 | 비고 |
|---|---|---|
| **구매번호/일시** | 주문 ID (`ORD-...`) 및 결제 시각 | 예: 2024.01.20 14:30 |
| **구매자 정보** | 이메일<br>전화번호 | **마스킹 처리 적용** |
| **항목** | 구매한 상품명 | 유료 리포트, 10회 이용권 등 |
| **결제금액/환불액** | 결제된 원금<br><span style="color:red">환불된 금액</span> | 상하단 병기 |
| **상태** | 결제 상태 뱃지 | 완료(Green), 실패(Red), 환불요청(Orange), 환불(Gray) |
| **잔여/환불** | 사용 가능한 횟수<br><span style="color:gray">환불된 횟수</span> | 상하단 병기 |
| **관리** | 관리 기능 버튼 | [환불신청] / [선택] 버튼 등 |

### 3.4 환불 처리 (Refund Modal)

- **진입**: 리스트의 [환불신청] 또는 관련 버튼 클릭 시 팝업 노출
- **정보 표시**: 구매자 정보, 결제 금액, 현재 잔여 횟수 등 표시
- **환불 수량 지정**: 부분 환불을 위해 환불할 횟수를 입력받음
- **결과 반영**:
  - 환불 완료 시 상태가 '환불 완료'로 변경
  - '잔여 개수'는 차감되고, '환불 개수'가 증가함
  - '환불액'이 결제 금액 컬럼에 붉은색으로 표기됨

---


---

## 4. 무료 이용권 관리 (Free Pass)

### 4.1 기능 개요

관리자가 특정 고객에게 무료 리포트 이용권(1회권)을 수동으로 지급할 수 있는 기능입니다.

### 4.2 주요 UX/UI

- **진입점**: 페이지 우측 상단 [이용권 추가] 버튼
- **팝업(Modal)**:
    - **검색**: 이메일 또는 전화번호 입력 시 실시간 자동완성 검색 (2글자 이상)
    - **다중 선택**: 검색 결과 클릭 시 "선택된 고객 목록"에 추가됨 (여러 명 계속 추가 가능)
    - **선택 관리**: 선택된 목록에서 개별 삭제 또는 전체 해제 가능
    - **신규 고객**: 검색 결과가 없을 경우, 입력한 정보로 신규 고객 생성 및 선택 목록 자동 추가
    - **일괄 지급**: "N명에게 무료 1회권 일괄 추가" 버튼 클릭 시 선택된 전원에게 지급 후 팝업 자동 종료

### 4.3 데이터 처리

- **상품명**: "무료 1회권"
- **결제수단**: "관리자 지급"
- **결제금액**: 0원
- **상태**: 결제 완료

---

## 5. 유저 스토리

### 5.1 이용권 현황 파악
**As a** 관리자
**I want to** 페이지 진입 시 이번 달의 유료 구매 수와 환불 요청 수를 바로 확인하고 싶다
**So that** 매출 현황과 CS 이슈를 빠르게 인지할 수 있다.

### 5.2 고객 문의 응대 (검색)
**As a** 관리자
**I want to** 고객의 전화번호나 이메일로 결제 내역을 검색하고 싶다
**So that** 고객 문의(유선/채널톡)가 왔을 때 신속하게 해당 고객의 구매 이력을 조회할 수 있다.

### 5.3 환불 처리
**As a** 관리자
**I want to** 고객의 환불 요청 건에 대해, 실제 사용하지 않은 잔여 횟수만큼만 부분 환불해주고 싶다
**So that** 합리적인 환불 처리를 통해 고객 만족도를 유지하면서 회사의 손실을 막을 수 있다.

### 5.4 무료 이용권 지급
**As a** 관리자
**I want to** 이벤트 당첨자나 프로모션 대상 고객 여러 명을 찾아 한 번에 무료 이용권을 지급하고 싶다
**So that** 개별적으로 하나씩 추가하는 번거로움 없이 효율적으로 보상을 지급할 수 있다.
